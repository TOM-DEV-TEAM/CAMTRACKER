{% extends 'layouts/base.html' %}
{% load static %}

{% block breadcrumbs %}{% endblock breadcrumbs %}

{% block content %}

    <!-- [ rating list ] end-->
    <div class="container mt-12 ">


        <nav class="navbar navbar-light bg-light">
            <div class="container-fluid">
                <div class="d-flex justify-content-between w-100" id="navbarNav">
                    <form action="/export_mouvement0/" method="post">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-success">Extraire vers Excel</button>
                    </form>
                </div>
            </div>
        </nav>
        <ul class="nav nav-tabs">
            <li class="nav-item">
                <a class="nav-link " aria-current="page" href="/liste_tt_mvt00/{{ util.id_user }}">PLT</a>
            </li>
            <li class="nav-item">
                <a class="nav-link " href="/liste_tt_mvt0/{{ util.id_user }}">ICD TOM</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/liste_tt_mvt01/{{ util.id_user }}">ICD CMA</a>
            </li>
            <li class="nav-item">
                <a class="nav-link " href="/liste_tt_mvt02/{{ util.id_user }}" tabindex="-1">SACHERIE</a>
            </li>
            <li class="nav-item">
                <a class="nav-link " href="/liste_tt_mvt03/{{ util.id_user }}" tabindex="-1">ZUD</a>
            </li>
            <li class="nav-item">
                <a class="nav-link active" href="/liste_tt_mvtpar/{{ util.id_user }}" tabindex="-1">PARTICULIER</a>
            </li>
        </ul>
        <br>
        <div class="table-responsive">
            <div class="text-left">

            </div>

            <table id="mouvements-table" class="table table-hover">
                <thead class="thead-light">
                <tr>
                    <th scope="col">Véhicule</th>
                    <th scope="col">Destination</th>
                    <th scope="col">Date Entrée</th>
                    <th scope="col">Pointeur Entrée</th>
                    <th scope="col">Date Sortie</th>
                    <th scope="col">Pointeur Sortie</th>
                    <!--th scope="col">Action</th-->

                </tr>
                </thead>
                <tbody>

                </tbody>
            </table>


        </div>
    </div>


    <!--<div class="container">
  <h2>Modal Example</h2>
   Trigger the modal with a button
  <button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myModal">Open Modal</button>
 Inclure les scripts de Bootstrap et jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            function fetchMouvements() {
                $.ajax({
                    url: "{% url 'liste_mouvements_dkpar' %}",
                    method: "GET",
                    success: function (data) {
                        var tableBody = $('#mouvements-table tbody');
                        tableBody.empty();
                        data.forEach(function (mouvement_list) {
                            var row = `
                            <tr>
                                <td>${mouvement_list.vehicule.immatriculation}</td>
                                <td>${mouvement_list.destination}</td>
<td>${mouvement_list.date_entree || 'Non Assigné'}</td>
<td>${mouvement_list.user_ert.fullname}</td>
<td>${mouvement_list.date_sortie || 'Non Assigné'}</td>
<td>${mouvement_list.user_srt && mouvement_list.user_srt.fullname ? mouvement_list.user_srt.fullname : 'Non assigné'}</td>
                            </tr>`;
                            tableBody.append(row);
                        });
                    }
                });
            }
            fetchMouvements();
            setInterval(fetchMouvements, 10000);
            $('#mouvements-table').on('click', '.btn-edit', function () {
                var id = $(this).data('id');
                var camion = $(this).data('camion');
                var transporteur = $(this).data('transporteur');
                var chauffeur = $(this).data('chauffeur');
                var permis = $(this).data('permis');
                var remorque = $(this).data('remorque');
                var statutEntree = $(this).data('statut-entree');
                var statutSortie = $(this).data('statut-sortie');
                var destination = $(this).data('destination');

                $('#mouvementId').val(id);
                $('#camion').val(camion);
                $('#transporteur').val(transporteur);
                $('#chauffeur').val(chauffeur);
                $('#permis').val(permis);
                $('#remorque').val(remorque);
                $('#statut_entree').val(statutEntree);
                $('#statut_sortie').val(statutSortie);
                $('#destination').val(destination);
            });
        });

    </script>

    </div>
    </div>



    <div class="modal fade" id="editModal" class="modal fade" tabindex="-1" role="dialog"
         aria-labelledby="editModalLabel" aria-hidden="true">

        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editModalLabel">Modifier Mouvement</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="editForm" method="POST" action="/modifier_mouvement0/">
                        <input type="hidden" id="mouvementId" name="mouvementId">
                        <input type="hidden" id="id_user" value="{{ util.id_user }}" name="id_user">
                        <!-- Ajoutez les champs de formulaire nécessaires ici -->

                        <div class="form-row">
                            <div class="col-md-6 mb-6">
                                <label for="camion">Camion</label>
                                <input type="text" name="camion" id="camion" class="form-control form-control-lg"
                                       placeholder="camion" required/>
                            </div>

                            <div class="col-md-6 mb-6">
                                <label for="camion">Remorque</label>
                                <input type="text" name="remorque" id="remorque" class="form-control form-control-lg"
                                       placeholder="REMORQUE" required/>

                            </div>
                        </div>

                        <div class="form-row">
                            <div class="col-md-6 mb-6">
                                <label for="camion">Permis</label>
                                <input type="text" name="permis" id="permis" class="form-control form-control-lg"
                                       placeholder="PERMIS" required/>
                            </div>
                            <div class="col-md-6 mb-6">
                                <label for="camion">Chauffeur</label>
                                <input type="text" name="chauffeur" id="chauffeur" class="form-control form-control-lg"
                                       required/>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="col-md-6 mb-6">
                                <label for="camion">Trasporteur</label>
                                <input type="text" name="transporteur" id="transporteur"
                                       class="form-control form-control-lg" required/>
                            </div>
                            <div class="col-md-6 mb-6">
                                <label for="camion">Destination</label>
                                <input type="text" name="destination" id="destination"
                                       class="form-control form-control-lg" required/>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="col-md-6 mb-6">
                                <label for="camion">Statut Entree</label>
                                <select id="statut_entree" name="statut_entree" class="form-control form-control-lg">

                                    <option value="1">CHARGE</option>
                                    <option value="0">DECHARGE</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-6">
                                <label for="camion">Statut Sortiessss</label>
                                <select id="statut_sortie" name="statut_sortie" class="form-control form-control-lg">

                                    <option value="1">CHARGE</option>
                                    <option value="0">DECHARGE</option>
                                </select>
                            </div>
                        </div>

                        <div class="modal-footer">
                            <button type="submit" class="btn btn-primary">Enregistrer</button>
                            <button type="button" class="btn btn-danger" data-dismiss="modal">Fermer</button>

                    </form>
                </div>
            </div>
        </div>
    </div>
{% endblock content %}